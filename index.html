<!doctype html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>Элина & Чингиз</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600&family=Inter:wght@300;400;500&display=swap"
      rel="stylesheet"
    />

    <style>
      :root {
        --gold: #c9ab81;
        --dark: #1f1f1f;
      }

      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        font-family: "Inter", sans-serif;
        color: white;
        background: black;
        overflow-x: hidden;
      }

      /* =========================
   PARALLAX BACKGROUND
========================= */
      .parallax-bg {
        position: fixed;
        inset: -12%;
        background-image: url("https://media.nazaccent.ru/files/b1/83/b1837b4808e19b898a79cd2fdceb4b5a.JPG");
        background-repeat: no-repeat;
        background-position: center center;
        background-size: cover;
        /* transform: scale(1.12); */
        will-change: transform;
        z-index: -2;
      }

      /* затемнение */
      .parallax-bg::after {
        content: "";
        position: absolute;
        inset: 0;
        background: linear-gradient(rgba(0, 0, 0, 0.45), rgba(0, 0, 0, 0.7));
      }

      /* GRAIN */
      body::after {
        content: "";
        position: fixed;
        inset: 0;
        pointer-events: none;
        background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='200' height='200'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='4'/%3E%3C/filter%3E%3Crect width='200' height='200' filter='url(%23n)' opacity='0.035'/%3E%3C/svg%3E");
        z-index: 999;
      }

      /* TYPO */
      h1,
      h2,
      h3 {
        font-family: "Playfair Display", serif;
        font-weight: 600;
      }

      section {
        max-width: 1100px;
        margin: 0 auto;
        padding: 120px 20px;
      }

      /* FADE */
      .fade {
        opacity: 0;
        transform: translateY(60px);
        transition: all 1.3s ease;
      }
      .fade.show {
        opacity: 1;
        transform: translateY(0);
      }

      /* HERO */
      .hero {
        height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        text-align: center;
      }

      .hero h1 {
        font-size: clamp(42px, 7vw, 82px);
        letter-spacing: 2px;
      }

      .hero p {
        margin-top: 10px;
        letter-spacing: 5px;
        text-transform: uppercase;
        opacity: 0.85;
      }

      /* GOLD LINE */
      .gold-line {
        width: 160px;
        height: 2px;
        background: linear-gradient(
          90deg,
          transparent,
          var(--gold),
          transparent
        );
        margin: 30px auto;
      }

      /* GLASS */
      .glass {
        background: rgba(255, 255, 255, 0.88);
        backdrop-filter: blur(10px);
        border-radius: 28px;
        padding: 50px;
        color: var(--dark);
        box-shadow: 0 40px 100px rgba(0, 0, 0, 0.35);
      }
      .glass.glass-form {
        padding: 10px;
      }

      /* CALENDAR */
      .calendar {
        display: inline-block;
        padding: 40px 55px;
        border: 2px solid var(--gold);
        border-radius: 26px;
        text-align: center;
      }
      .calendar .month,
      .calendar .year {
        font-size: 22px;
        letter-spacing: 3px;
      }
      .calendar .day {
        font-size: 88px;
        font-family: "Playfair Display", serif;
        font-weight: 700;
        color: var(--gold);
        line-height: 1;
        margin: 10px 0;
      }

      /* PROGRAM */
      .program li {
        list-style: none;
        padding: 18px 0;
        border-bottom: 1px solid rgba(0, 0, 0, 0.15);
        font-size: 18px;
      }

      /* LOCATION */
      .location {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 40px;
        align-items: center;
      }

      .location img {
        width: 100%;
        border-radius: 22px;
        box-shadow: 0 30px 60px rgba(0, 0, 0, 0.35);
      }

      /* FORM */
      .form-wrapper iframe {
        width: 100%;
        height: auto;
        border: none;
      }

      footer {
        text-align: center;
        padding: 80px 20px;
        /* opacity: 0.6; */
        font-size: 28px;
      }

      @media (max-width: 900px) {
        section {
          padding: 90px 16px;
        }
        .location {
          grid-template-columns: 1fr;
        }
      }

      .rsvp-card {
        max-width: 520px;
        margin: 0 auto;
        padding: 50px 40px;
        background: rgba(255, 255, 255, 0.85);
        backdrop-filter: blur(20px);
        border-radius: 28px;
        box-shadow: 0 25px 60px rgba(0, 0, 0, 0.12);
        animation: fadeUp 1s ease;
      }

      .rsvp-title {
        text-align: center;
        font-size: 28px;
        margin-bottom: 10px;
        font-weight: 500;
        color: black;
      }

      .rsvp-sub {
        text-align: center;
        font-size: 15px;
        color: #777;
        margin-bottom: 35px;
      }
      .rsvp-somebody {
        text-align: left;
        font-size: 15px;
        color: #000000;
        margin: 15px 0 5px;
      }

      .radio-group {
        display: flex;
        gap: 15px;
        margin-top: 15px;
      }

      .radio-option {
        flex: 1;
        position: relative;
      }

      .radio-option input {
        display: none;
      }

      .radio-box {
        padding: 16px;
        border-radius: 16px;
        border: 1.5px solid #777;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s ease;
        color: black;
      }

      .radio-option input:checked + .radio-box {
        background-color: rgb(177, 197, 163);
      }

      .input-modern {
        width: 100%;
        padding: 16px;
        margin-top: 20px;
        border-radius: 14px;
        border: 1.5px solid #e5e5e5;
        font-size: 15px;
        transition: all 0.3s ease;
        background: white;
      }

      .input-modern:focus {
        outline: none;
        border-color: #c9ab81;
        box-shadow: 0 0 0 4px rgba(201, 171, 129, 0.15);
      }

      .save-btn-modern {
        width: 100%;
        margin-top: 30px;
        padding: 16px;
        border-radius: 16px;
        border: none;
        font-size: 15px;
        letter-spacing: 1px;
        cursor: pointer;
        background: linear-gradient(135deg, #c9ab81, #b89365);
        color: white;
        transition: all 0.3s ease;
      }

      .save-btn-modern:hover {
        transform: translateY(-3px);
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
      }

      .status-text {
        text-align: center;
        margin-top: 18px;
        font-size: 14px;
        color: #4caf50;
        opacity: 0;
        transition: opacity 0.4s ease;
      }

      .status-text.show {
        opacity: 1;
      }

      @keyframes fadeUp {
        from {
          opacity: 0;
          transform: translateY(30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @media (max-width: 600px) {
        .rsvp-card {
          padding: 35px 25px;
        }
      }
    </style>
  </head>
  <!-- FIREBASE -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import {
      getFirestore,
      doc,
      getDoc,
      setDoc,
      serverTimestamp,
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDCcOYnGQksJUe6P-kKlUEOtmsIXdBwH4E",
      authDomain: "wedding-invite-51714.firebaseapp.com",
      projectId: "wedding-invite-51714",
      storageBucket: "wedding-invite-51714.firebasestorage.app",
      messagingSenderId: "881433018362",
      appId: "1:881433018362:web:5c573164a8ea308004ee43",
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Получаем ID гостя из URL
    const params = new URLSearchParams(window.location.search);
    const guestId = params.get("guest");

    if (!guestId) {
      document.getElementById("rsvp-section").innerHTML =
        "<h3 style='text-align:center'>Ошибка: отсутствует персональная ссылка.</h3>";
    } else {
      loadGuest();
    }
    async function loadGuest() {
      const ref = doc(db, "guests", guestId);
      const snap = await getDoc(ref);

      if (snap.exists()) {
        const data = snap.data();

        document.getElementById("firstName").value = data.firstName || "";
        document.getElementById("lastName").value = data.lastName || "";
        document.getElementById("phone").value = data.phone || "";

        if (data.withSomeone) {
          document.getElementById("yes").checked = true;
          document.getElementById("companion-block").style.display = "block";
          document.getElementById("companionName").value =
            data.companionName || "";
        } else if (data.withSomeone === false) {
          document.getElementById("no").checked = true;
        }
      }
    }

    document.getElementById("yes").addEventListener("change", () => {
      document.getElementById("companion-block").style.display = "block";
    });

    document.getElementById("no").addEventListener("change", () => {
      document.getElementById("companion-block").style.display = "none";
    });

    document.getElementById("saveBtn").addEventListener("click", async () => {
      const firstName = document.getElementById("firstName").value.trim();
      const lastName = document.getElementById("lastName").value.trim();
      const phone = document.getElementById("phone").value.trim();
      const withSomeone = document.getElementById("yes").checked;
      const noSelected = document.getElementById("no").checked;
      const companionName = document
        .getElementById("companionName")
        .value.trim();

      // Валидация
      if (!firstName || !lastName || !phone) {
        alert("Пожалуйста, заполните все обязательные поля.");
        return;
      }

      if (!withSomeone && !noSelected) {
        alert("Пожалуйста, выберите вариант ответа.");
        return;
      }

      if (withSomeone && !companionName) {
        alert("ФИО того, с кем придете.");
        return;
      }

      // Простая проверка телефона
      const phoneRegex = /^[0-9+\-\s()]{6,20}$/;
      if (!phoneRegex.test(phone)) {
        alert("Введите корректный номер телефона.");
        return;
      }

      await setDoc(doc(db, "guests", guestId), {
        firstName,
        lastName,
        phone,
        withSomeone,
        companionName: withSomeone ? companionName : "",
        updatedAt: serverTimestamp(),
      });

      const status = document.getElementById("status");
      status.classList.add("show");
      setTimeout(() => status.classList.remove("show"), 3000);
    });
  </script>

  <body>
    <div class="parallax-bg" id="parallax"></div>

    <section class="hero fade">
      <div>
        <h1>Элина & Чингиз</h1>
        <div class="gold-line"></div>
        <p>4 июля 2026</p>
      </div>
    </section>

    <section class="fade">
      <div class="glass" style="text-align: center">
        <h2>Дата нашего дня</h2>
        <div class="gold-line"></div>
        <div class="calendar">
          <div class="month">ИЮЛЬ</div>
          <div class="day">4</div>
          <div class="year">2026</div>
        </div>
      </div>
    </section>

    <section class="fade">
      <div class="glass">
        <h2 style="text-align: center">Программа дня</h2>
        <div class="gold-line"></div>
        <ul class="program">
          <li>15:00 — Сбор гостей</li>
          <li>16:00 — Церемония</li>
          <li>17:00 — Фото и аперитив</li>
          <li>17:10 — Фотка с Диманом и Ирой</li>
          <li>18:30 — Банкет</li>
        </ul>
      </div>
    </section>

    <section class="fade">
      <div class="glass">
        <h2 style="text-align: center">Место проведения</h2>
        <div class="gold-line"></div>

        <div class="location">
          <img
            src="https://buyingbusinesstravel.com.ru/upload/medialibrary/f04/ixfld41v7d6ns81lhg2ozlh96syue8qr.jpg"
            alt="Место проведения"
          />

          <div>
            <h3 style="padding-bottom: 20px">Лакшери коллекшн рэдисон</h3>
            <p>
              Уютная площадка с невероятным люксом, светом и пространством для
              праздника
            </p>
          </div>
        </div>
      </div>
    </section>

    <section class="fade">
      <div class="rsvp-card" id="rsvp-section">
        <div class="rsvp-title">Подтверждение присутствия</div>
        <div class="rsvp-sub">Пожалуйста, заполните форму ниже</div>

        <!-- Имя -->
        <input
          type="text"
          id="firstName"
          class="input-modern"
          placeholder="Имя *"
          required
        />

        <!-- Фамилия -->
        <input
          type="text"
          id="lastName"
          class="input-modern"
          placeholder="Фамилия *"
          required
        />

        <!-- Телефон -->
        <input
          type="tel"
          id="phone"
          class="input-modern"
          placeholder="Номер телефона *"
          required
        />

        <div class="rsvp-somebody">Вы будете с кем-то? *</div>

        <div class="radio-group">
          <label class="radio-option">
            <input type="radio" name="with" id="yes" required />
            <div class="radio-box">Да</div>
          </label>

          <label class="radio-option">
            <input type="radio" name="with" id="no" required />
            <div class="radio-box">Нет</div>
          </label>
        </div>

        <div id="companion-block" style="display: none">
          <input
            type="text"
            id="companionName"
            class="input-modern"
            placeholder="ФИО сопровождающего *"
          />
        </div>

        <button id="saveBtn" class="save-btn-modern">Сохранить ответ</button>

        <div id="status" class="status-text">Ответ сохранён ✓</div>
      </div>
    </section>

    <footer>
      С любовью, Элина и Чингиз <span style="color: #ff3636">&#10084;</span>
    </footer>

    <script>
      window.addEventListener("scroll", () => {
        const scroll = window.pageYOffset;
        document.getElementById("parallax").style.transform =
          `translateY(${-scroll * 0.05}px)`;
      });

      const observer = new IntersectionObserver(
        (entries) => {
          entries.forEach((e) => {
            if (e.isIntersecting) e.target.classList.add("show");
          });
        },
        { threshold: 0.2 },
      );

      document.querySelectorAll(".fade").forEach((el) => observer.observe(el));
    </script>
  </body>
</html>
